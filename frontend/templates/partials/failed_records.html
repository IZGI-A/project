{% if failed_records %}
<table class="table table-sm mb-0">
    <thead>
        <tr><th>Loan Type</th><th>File Type</th><th>Failed Rows</th><th>Actions</th></tr>
    </thead>
    <tbody>
    {% for fr in failed_records %}
    <tr>
        <td><span class="badge bg-dark">{{ fr.loan_type }}</span></td>
        <td>{{ fr.file_type }}</td>
        <td><span class="badge bg-danger">{{ fr.count }}</span></td>
        <td>
            <div class="d-flex gap-1">
                <button class="btn btn-sm btn-outline-secondary"
                        hx-get="{% url 'frontend:failed-preview' %}?loan_type={{ fr.loan_type }}&file_type={{ fr.file_type }}"
                        hx-target="#preview-modal-body"
                        hx-swap="innerHTML"
                        data-bs-toggle="modal"
                        data-bs-target="#previewModal"
                        title="Preview failed records">
                    <i class="bi bi-eye"></i> Preview
                </button>
                <a href="{% url 'frontend:failed-download' %}?loan_type={{ fr.loan_type }}&file_type={{ fr.file_type }}"
                   class="btn btn-sm btn-outline-primary" title="Download CSV to fix and re-upload">
                    <i class="bi bi-download"></i> Download
                </a>
                <button class="btn btn-sm btn-outline-danger"
                        hx-post="{% url 'frontend:failed-dismiss' %}"
                        hx-vals='{"loan_type": "{{ fr.loan_type }}", "file_type": "{{ fr.file_type }}"}'
                        hx-target="#failed-records"
                        hx-swap="innerHTML"
                        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                        hx-confirm="{{ fr.count }} failed record(s) will be permanently deleted. Continue?"
                        title="Permanently delete failed records">
                    <i class="bi bi-trash"></i> Dismiss
                </button>
            </div>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h6 class="modal-title">Failed Records Preview</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0" id="preview-modal-body">
                <div class="text-center py-4 text-muted">Loading...</div>
            </div>
        </div>
    </div>
</div>
{% else %}
<p class="text-muted text-center mb-0 py-3">No failed records</p>
{% endif %}

{% if failed_records %}
<div class="table-responsive">
<table class="table table-glass table-hover">
    <thead>
        <tr><th>Loan Type</th><th>File Type</th><th>Failed Rows</th><th>Actions</th></tr>
    </thead>
    <tbody>
    {% for fr in failed_records %}
    <tr>
        <td><span class="badge badge-glass">{{ fr.loan_type }}</span></td>
        <td class="text-secondary">{{ fr.file_type }}</td>
        <td><span class="badge badge-danger-glass">{{ fr.count }}</span></td>
        <td>
            <div class="d-flex gap-1 flex-wrap">
                <button class="btn btn-glass btn-sm"
                        hx-get="{% url 'frontend:failed-preview' %}?loan_type={{ fr.loan_type }}&file_type={{ fr.file_type }}"
                        hx-target="#preview-modal-body"
                        hx-swap="innerHTML"
                        data-bs-toggle="modal"
                        data-bs-target="#previewModal"
                        title="Preview failed records"
                        style="font-size: 0.78rem;">
                    <i class="bi bi-eye"></i><span class="d-none d-md-inline"> Preview</span>
                </button>
                <a href="{% url 'frontend:failed-download' %}?loan_type={{ fr.loan_type }}&file_type={{ fr.file_type }}"
                   class="btn btn-glass btn-sm" title="Download CSV"
                   style="font-size: 0.78rem; color: var(--accent-cyan);">
                    <i class="bi bi-download"></i><span class="d-none d-md-inline"> Download</span>
                </a>
                <button class="btn btn-glass btn-sm"
                        hx-post="{% url 'frontend:failed-dismiss' %}"
                        hx-vals='{"loan_type": "{{ fr.loan_type }}", "file_type": "{{ fr.file_type }}"}'
                        hx-target="#failed-records"
                        hx-swap="innerHTML"
                        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                        hx-confirm="{{ fr.count }} failed record(s) will be permanently deleted. Continue?"
                        title="Permanently delete failed records"
                        style="font-size: 0.78rem; color: var(--accent-red);">
                    <i class="bi bi-trash"></i><span class="d-none d-md-inline"> Dismiss</span>
                </button>
            </div>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
</div>
{% else %}
<p class="text-secondary text-center mb-0 py-3">No failed records</p>
{% endif %}
